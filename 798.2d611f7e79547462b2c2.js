(self.webpackChunkoptical_breacher=self.webpackChunkoptical_breacher||[]).push([[798],{9798:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>M});var n=i(5893),r=i(7294);const s=i.p+"lib/example.450cf14c6c6d4f14fede9bd9f9abf560.jpg",a=e=>e.split(" ").filter(Boolean).map((e=>e[0]));function o(e,t){const i=window.localStorage.getItem(e)||t,[n,s]=(0,r.useState)(i);return(0,r.useEffect)((()=>{window.localStorage.setItem(e,n)}),[n]),[n,s]}function c(e,t=!1){const{width:i,height:n}=e.canvas,r=i*n,s=e.getImageData(0,0,i,n),{data:a}=s;let o=128;if(!t){const e=Array(256).fill(0);for(let t=0;t<a.length;t+=4)a[t]=Math.round(.7*a[t]+.2*a[t+1]+.1*a[t+2]),e[a[t]]++;const t=.01;let i=0,n=0;for(let s=0;s<256;s++)if(n+=e[s]||0,n>r*t){i=s;break}let s=0,c=0;for(let i=255;i>=0;i--)if(c+=e[i]||0,c>r*t){s=i;break}let d=1/0;const l=s-i,h=i+.9*l;for(let t=i+Math.floor(.65*l);t<=h;t++)e[t]<d&&(d=e[t],o=t)}for(let e=0;e<a.length;e+=4){const t=a[e]>o?0:255;a[e]=t,a[e+1]=t,a[e+2]=t}e.putImageData(s,0,0)}const d=16/9;function l({onCapture:e}){const[t,i]=(0,r.useState)({width:240,height:320}),[a,l]=(0,r.useState)(!1),h=(0,r.useRef)(null),g=(0,r.useRef)(null),[u,f]=(0,r.useState)(!1),[v,m]=(0,r.useState)(!1),[p,x]=(0,r.useState)(!1),[j,b]=(0,r.useState)(),[y,w]=(0,r.useState)(),[O,S]=o("nativeResolutionOn","1"),k=(0,r.useCallback)((()=>{if(h.current&&g.current){const e=g.current.clientWidth,t=e/d;h.current.width=e,h.current.height=t,i({width:e,height:t})}}),[i]);(0,r.useEffect)((()=>(window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)})),[k]),(0,r.useEffect)((()=>{try{navigator.mediaDevices.getUserMedia({audio:!1,video:Object.assign(Object.assign({},"1"===O?{width:{ideal:7680},height:{ideal:4320}}:void 0),y?{deviceId:{exact:y}}:{facingMode:"environment"})}).then((e=>{h.current.srcObject=e}))}catch(e){throw new Error("WebRTC not supported")}}),[y,O]),(0,r.useEffect)((()=>{v&&(()=>{var e,t,i,n;e=this,t=void 0,n=function*(){try{const e=yield navigator.mediaDevices.enumerateDevices();b(e.filter((({kind:e})=>"videoinput"===e)))}catch(e){throw new Error("WebRTC not supported")}},new((i=void 0)||(i=Promise))((function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))})()}),[v]);const C=(0,r.useRef)([]),E=(0,r.useRef)({distance:1,scale:1}),[I,M]=o("zoomScale",1),P=parseFloat(I),z=e=>{C.current=C.current.filter((t=>t.pointerId!==e.pointerId))},D=()=>{const e=C.current[0].clientX,t=C.current[0].clientY,i=C.current[1].clientX,n=C.current[1].clientY;return Math.sqrt(Math.pow(e-i,2)+Math.pow(t-n,2))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",Object.assign({style:{margin:16,border:"1px solid #ff606060",flexShrink:0}},{children:[(0,n.jsxs)("div",Object.assign({style:{display:"flex",justifyContent:"space-between",padding:"0 4px",color:"#cfed57"}},{children:[(0,n.jsx)("div",{children:"CODE MATRIX"},void 0),(0,n.jsx)("div",{children:"SEQUENCE"},void 0)]}),void 0),(0,n.jsxs)("div",Object.assign({ref:g,style:{position:"relative",overflow:"hidden",touchAction:"none",display:"flex",justifyContent:"center",alignItems:"center"},onPointerDown:e=>{C.current=[...C.current,e],2===C.current.length&&(E.current={distance:D(),scale:P})},onPointerMove:e=>{if(C.current=C.current.map((t=>t.pointerId===e.pointerId?e:t)),2===C.current.length){const e=D()/E.current.distance;M(Math.max(Math.min(E.current.scale*e,10),1))}},onPointerUp:z,onPointerCancel:z,onPointerLeave:z,onPointerOut:z},{children:[(0,n.jsx)("video",{ref:h,playsInline:!0,onCanPlay:()=>{var e;null===(e=null==h?void 0:h.current)||void 0===e||e.play(),l(!0),k()},style:{objectFit:"cover",transform:`scale(${P})`},muted:!0},void 0),a&&(0,n.jsxs)("div",Object.assign({style:{boxSizing:"border-box",position:"absolute",display:"grid",top:0,gridTemplateColumns:"5fr 2fr",padding:4,width:t.width,height:t.height}},{children:[(0,n.jsx)("div",{style:{gridColumn:1,border:"1px dashed #cfed57"}},void 0),(0,n.jsx)("div",{style:{gridColumn:2,border:"1px dashed #cfed57",borderLeft:0}},void 0)]}),void 0)]}),void 0),(0,n.jsxs)("div",Object.assign({style:{fontSize:"0.4em",color:"#ff606080",margin:2,whiteSpace:"pre"}},{children:["ZOOM_RATIO","    ",P.toFixed(6),"x"]}),void 0)]}),void 0),(0,n.jsxs)("div",Object.assign({style:{margin:16,marginTop:0,overflow:"auto"}},{children:["Move the camera closer to the screen (or use pinch zoom) to avoid unnecessary contents. Don't rotate or tilt.",(0,n.jsxs)("a",Object.assign({style:{marginLeft:4},href:"#",onClick:()=>{f(!u)}},{children:[u?"Hide":"Show"," the example"]}),void 0),u&&(0,n.jsx)("div",{children:(0,n.jsx)("img",{style:{width:"70%"},src:s},void 0)},void 0),(0,n.jsx)("div",Object.assign({style:{marginTop:8}},{children:v?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:"- Specify the camera to use:"},void 0),(0,n.jsx)("select",Object.assign({onChange:e=>{w(e.target.value)},value:y},{children:j&&j.map((({label:e,deviceId:t},i)=>(0,n.jsxs)("option",Object.assign({value:t},{children:[i+1,": ",e]}),t)))}),void 0),(0,n.jsxs)("label",Object.assign({style:{display:"block",marginTop:8}},{children:["-",(0,n.jsx)("input",{type:"checkbox",checked:"1"===O,onChange:()=>{S("0"===O?"1":"0")}},void 0),"Use native resolution"," ",(0,n.jsx)("small",Object.assign({style:{fontSize:"0.6em"}},{children:"(turning it off may fix the black camera issue)"}),void 0)]}),void 0),p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:["iOS user: Please use Safari browser (see"," ",(0,n.jsx)("a",Object.assign({href:"https://stackoverflow.com/a/29164511",rel:"noopener",target:"_blank"},{children:"why"}),void 0),'). Make sure you have granted access to the camera (Settings - Safari - Camera - choose "Ask")']},void 0),(0,n.jsxs)("p",{children:["Android user: If none of the options above work, please check"," ",(0,n.jsx)("a",Object.assign({href:"https://github.com/govizlora/optical-breacher/issues/7",target:"_blank",rel:"noopener"},{children:"this issue"}),void 0),"."]},void 0)]},void 0):(0,n.jsx)("a",Object.assign({onClick:()=>{x(!0)},href:"#"},{children:"Still not working?"}),void 0)]},void 0):(0,n.jsx)("a",Object.assign({onClick:()=>{m(!0)},href:"#"},{children:"Camera not working?"}),void 0)}),void 0)]}),void 0),(0,n.jsx)("button",Object.assign({className:"main",style:{margin:"auto",marginBottom:16},onClick:()=>{const t=document.createElement("canvas"),i=h.current.srcObject,{width:n=1,height:r=1}=i.getTracks()[0].getSettings();let s=0,a=0,o=r/P,l=n/P;const g=t.getContext("2d");n/r>d?(l=o*d,t.height=Math.min(o,720),t.width=t.height*d):(o=l/d,t.width=Math.min(l,1280),t.height=t.width/d),s=(n-l)/2,a=(r-o)/2,g.drawImage(h.current,s,a,l,o,0,0,t.width,t.height),c(g),e(t)}},{children:"SCAN"}),void 0)]},void 0)}var h=i(7320);const g=i.p+"lib/worker.min.6ae4421cc24575c3996815e8a7e47a34.js",u=i.p+"lib/tesseract-core.wasm.e4db7f953ac7bcf9f67bd39031e42241.js";var f=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};class v{constructor(e){this.logger=e,this.terminate=()=>f(this,void 0,void 0,(function*(){return Promise.all([(yield this.targetsWorker).terminate(),(yield this.matrixWorker).terminate])})),this.matrixWorker=this.createWorker("matrix",{tessedit_pageseg_mode:"6",tessedit_ocr_engine_mode:1}),this.targetsWorker=this.createWorker("targets",{tessedit_pageseg_mode:"6",tessedit_ocr_engine_mode:1})}recognize(e,t,i){return f(this,void 0,void 0,(function*(){const n=yield this.matrixWorker,r=yield this.targetsWorker,s=yield Promise.all([n.recognize(e,{rectangle:{left:0,top:0,width:.65*t,height:i}}),r.recognize(e,{rectangle:{left:.65*t,top:0,width:.35*t,height:i}})]);return{matrixData:s[0].data,targetsData:s[1].data}}))}createWorker(e,t){return f(this,void 0,void 0,(function*(){const i=(0,h.createWorker)({langPath:"./lib",workerPath:g,corePath:u,logger:t=>this.logger(Object.assign({name:e},t))});return yield i.load(),yield i.loadLanguage("cyber"),yield i.initialize("cyber"),yield i.setParameters(t),i}))}}var m=i(6486);const p=(e,t)=>e.map((e=>{let i="";for(let n=0;n<e.length;n+=2)i+=t[parseInt(e[n],10)][parseInt(e[n+1],10)];return i})),x=({bufferSize:e,orientation:t,index:i,used:n,matrix:r,targets:s})=>{const a=(0,m.range)(r.length).map((e=>"row"===t?i+e:e+i)).filter((e=>!n.has(e)));if(1===e)return a;const o=(0,m.flatMap)(a,(i=>x({bufferSize:Math.min(e,6)-1,orientation:"row"===t?"col":"row",index:"row"===t?i[1]:i[0],used:new Set(n).add(i),matrix:r,targets:s}).map((e=>i+e))));if(e>6){const t=p(o,r),i=s.map((e=>e.join(""))),n=o.filter(((e,n)=>i.some((e=>t[n].includes(e)))));return(0,m.flatMap)(n,(t=>x({bufferSize:e-6,orientation:"row",index:t[10],used:new Set(t.match(/.{1,2}/g)),matrix:r,targets:s}).map((e=>t+e))))}return o},j={1:"1C",7:"7A",5:"55",B:"BD",E:"E9",F:"FF"};function b({matrix:e,targets:t,onStartOver:i}){const s=window.localStorage.getItem("buffer_size")||"8",[a,o]=(0,r.useState)(parseInt(s,10)),[c,d]=(0,r.useState)(new Set),l=e.length>2&&t.length&&e[0].length>2,h=(0,r.useMemo)((()=>{const i=t.filter((e=>!c.has(e.join("-"))));if(l&&i.length&&a){const t=((e,t,i)=>((e,t,i)=>{const n=p(e,t),r=i.map((e=>e.join("")));let s=0;const a=n.map(((e,t)=>{let i=0,n=0;const a=[];return r.forEach(((t,r)=>{const s=e.indexOf(t);if(s>-1){i+=1+.1*r;const e=s+t.length;n=Math.max(n,e),a.push(r)}})),s=Math.max(i,s),{score:i,stringIndex:t,seqLength:n,matchedIndices:a}})).filter((({score:e})=>e===s)),o=Math.min(...a.map((({seqLength:e})=>e))),c=a.filter((({seqLength:e})=>e===o)).map((({stringIndex:t,matchedIndices:i})=>({seq:e[t].slice(0,2*o),matchedIndices:i})));return(0,m.uniqBy)(c,(({seq:e})=>e))})(x({bufferSize:i,orientation:"row",index:"0",used:new Set,matrix:e,targets:t}),e,t))(e,i,a)[0]||{seq:[],matchedIndices:[]},n={};return(0,m.chunk)(t.seq,2).forEach((([e,t],i)=>{n[`${e},${t}`]=i})),{chosenBytes:n,matched:new Set(t.matchedIndices)}}return{chosenBytes:{},matched:new Set}}),[e,t,a,c,l]);if(!l)throw Error("OCR result unacceptable");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",Object.assign({style:{margin:8,border:"1px solid #cfed5780",backgroundColor:"#120f18",paddingBottom:8}},{children:[(0,n.jsx)("div",Object.assign({style:{backgroundColor:"#cfed57",color:"black",padding:"4px 16px",marginBottom:8}},{children:"BEST ROUTE"}),void 0),e.map(((e,t)=>(0,n.jsx)("div",Object.assign({style:{display:"flex",justifyContent:"center"}},{children:e.map(((e,i)=>{const r=h.chosenBytes[`${t},${i}`];return(0,n.jsxs)("span",Object.assign({style:{position:"relative",display:"inline-flex",color:void 0!==r?"#ccee70":"#ccee7060",fontSize:"1.2em",textTransform:"uppercase",width:40,height:32,justifyContent:"center",alignItems:"center"}},{children:[j[e],void 0!==r&&(0,n.jsx)("span",Object.assign({style:{position:"absolute",fontSize:"0.6em",top:0,right:0}},{children:r+1}),void 0)]}),`${e}-${i}`)}))}),`${e.join("-")}-${t}`)))]}),void 0),(0,n.jsxs)("div",Object.assign({style:{margin:8,marginTop:0,border:"1px solid #cfed5780",backgroundColor:"#120f18",paddingBottom:8}},{children:[(0,n.jsx)("div",Object.assign({style:{color:"#cfed57",padding:"4px 16px",marginBottom:8,borderBottom:"1px solid #cfed5780"}},{children:"TARGET SEQUENCES"}),void 0),t.filter((e=>!c.has(e.join("-")))).map(((e,t)=>(0,n.jsxs)("div",Object.assign({style:{paddingLeft:16}},{children:[e.map(((e,i)=>(0,n.jsx)("div",Object.assign({style:{display:"inline-flex",color:h.matched.has(t)?"#cfed57":"#FFFFFF40",fontSize:"1.1em",textTransform:"uppercase",width:32,height:28,justifyContent:"center",alignItems:"center"}},{children:j[e]}),`${e}-${i}`))),(0,n.jsx)("a",Object.assign({style:{display:"float",float:"right",marginRight:16,color:"#cfed57"},onClick:()=>{d(new Set(c).add(e.join("-")))},href:"#"},{children:"Remove"}),void 0)]}),e.join("-"))))]}),void 0),(0,n.jsxs)("div",Object.assign({style:{marginLeft:8,color:"#cfed57"}},{children:[(0,n.jsx)("label",{children:"BUFFER SIZE:"},void 0),(0,n.jsx)("input",{type:"number",min:2,max:9,name:"buffer-size",style:{marginLeft:8},value:a,onChange:e=>{const t=Math.min(Math.max(parseInt(e.target.value,9),4),10);o(t),window.localStorage.setItem("buffer_size",`${t}`)}},void 0)]}),void 0),(0,n.jsx)("button",Object.assign({style:{margin:"auto",marginBottom:16},onClick:i,className:"main"},{children:"START OVER"}),void 0)]},void 0)}var y=i(2238);const w=i.p+"lib/crop-example.e9de0e49471f69deefc6b011e4a57fa1.jpg";const O=({handleFile:e,toCameraMode:t})=>{const[i,s]=(0,r.useState)(!1),[a,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("label",Object.assign({style:Object.assign({margin:16,flexBasis:300,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",padding:"0 48px"},i&&{backgroundColor:"#ff606020"}),className:"dropzone",onDragOver:e=>{e.preventDefault()},onDragEnter:e=>{e.target===e.currentTarget&&s(!0)},onDragLeave:e=>{e.target===e.currentTarget&&s(!1)},onDrop:t=>{return i=void 0,n=void 0,a=function*(){var i,n;s(!1),t.preventDefault();const r=null===(n=null===(i=t.dataTransfer)||void 0===i?void 0:i.items)||void 0===n?void 0:n[0],a="file"===r.kind?r.getAsFile():null;a&&e(a).catch((()=>{o("Invalid image")}))},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(s,o)}c((a=a.apply(i,n||[])).next())}));var i,n,r,a}},{children:[(0,n.jsxs)("div",Object.assign({style:{pointerEvents:"none"}},{children:[(0,n.jsx)("div",{children:"To start, you can:"},void 0),(0,n.jsx)("div",{children:"- Drag an image into the box"},void 0),(0,n.jsx)("div",{children:"- or click the box to upload an image"},void 0),(0,n.jsx)("div",{children:"- or make an in-game screenshot using WIN + SHIFT + S, then CTRL + V here"},void 0)]}),void 0),(0,n.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:t=>{var i;const n=null===(i=t.target.files)||void 0===i?void 0:i[0];n&&e(n).catch((()=>{o("Invalid image")}))}},void 0)]}),void 0),a&&(0,n.jsxs)("div",Object.assign({style:{marginLeft:16}},{children:["Error: ",a]}),void 0),(0,n.jsxs)("div",Object.assign({style:{margin:"0 16px"}},{children:["Please crop the screenshot before uploading.",(0,n.jsxs)("a",Object.assign({style:{marginLeft:4},href:"#",onClick:()=>{d(!c)}},{children:[c?"Hide":"Show"," the example"]}),void 0),c&&(0,n.jsx)("div",{children:(0,n.jsx)("img",{style:{maxHeight:240,maxWidth:"100%"},src:w},void 0)},void 0)]}),void 0),(0,n.jsxs)("div",Object.assign({style:{margin:"8px 16px"}},{children:["Alternatively, you can"," ",(0,n.jsx)("a",Object.assign({href:"#",onClick:t},{children:"use the camera"}),void 0)]}),void 0)]},void 0)};var S,k=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};const C={matrixProgress:0,targetsProgress:0,status:""},E={matrix:[],targets:[],finished:!1},I=null===(S=(new y.UAParser).getDevice())||void 0===S?void 0:S.type;function M(){const e=(0,r.useRef)(),[t,i]=(0,r.useState)(E),[s,o]=(0,r.useState)(C),[d,h]=(0,r.useState)(!0),[g,u]=(0,r.useState)("mobile"===I||"tablet"===I),f=(0,r.useCallback)((({name:e,status:t,progress:i=0})=>{"recognizing text"===t&&o((n=>({status:t,matrixProgress:"matrix"===e?i:n.matrixProgress,targetsProgress:"targets"===e?i:n.targetsProgress})))}),[]);(0,r.useEffect)((()=>(e.current=new v(f),()=>{var t;null===(t=e.current)||void 0===t||t.terminate()})),[]);const m=(0,r.useCallback)((t=>k(this,void 0,void 0,(function*(){h(!1),o(C),i(E);const n=yield e.current.recognize(t,t.width,t.height),{lines:r,chars:s}=function(e){const t=e.split("\n").map(a).filter((e=>e.length)),i=function(e){var t;const i={};return e.forEach((e=>{i[e.length]=i[e.length]||0,i[e.length]++})),parseInt((null===(t=Object.entries(i).sort(((e,t)=>t[1]-e[1]))[0])||void 0===t?void 0:t[0])||"0",10)}(t),n=t.filter((e=>e.length===i)),r=new Set;return n.forEach((e=>{e.forEach((e=>{r.add(e)}))})),{lines:n,chars:r}}(n.matrixData.text),c=(d=n.targetsData.text,l=s,d.split("\n").map(a).filter((e=>e.length>=2&&e.length<=4&&e.every((e=>l.has(e))))));var d,l;i({matrix:r,targets:c,finished:!0})}))),[]),p=(0,r.useCallback)((e=>k(this,void 0,void 0,(function*(){const t=yield createImageBitmap(e),i=document.createElement("canvas"),n=i.getContext("2d");i.width=Math.min(t.width,1280),i.height=i.width/t.width*t.height,n.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),c(n,!0),m(i)}))),[m]);return(0,r.useEffect)((()=>{const e=e=>{var t,i;if(g)return;e.preventDefault();const n=null===(i=null===(t=e.clipboardData)||void 0===t?void 0:t.items)||void 0===i?void 0:i[0],r="file"===(null==n?void 0:n.kind)?n.getAsFile():null;r&&p(r)};return document.addEventListener("paste",e),()=>{document.removeEventListener("paste",e)}}),[p,g]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",Object.assign({style:{display:"flex",flexDirection:"column",height:"calc(100% - 16px)",border:"1px solid #ff606080"}},{children:d?g?(0,n.jsx)(l,{onCapture:m},void 0):(0,n.jsx)(O,{handleFile:p,toCameraMode:()=>{u(!0)}},void 0):t.finished?(0,n.jsx)(b,{matrix:t.matrix,targets:t.targets,onStartOver:()=>{h(!0)}},void 0):(0,n.jsx)("progress",{style:{margin:"auto"},value:"recognizing text"===s.status?(s.matrixProgress+s.targetsProgress)/2:0},void 0)}),void 0),(0,n.jsxs)("div",Object.assign({style:{height:16,fontSize:"0.6em",display:"flex",color:"#ff6060a0"}},{children:[(0,n.jsx)("span",Object.assign({style:{marginRight:4}},{children:"OPTICAL BREACHER MK.1 Rev 1.8"}),void 0),(0,n.jsx)("a",Object.assign({style:{marginLeft:"auto",color:"inherit"},href:"https://github.com/govizlora/optical-breacher",rel:"noopener",target:"_blank"},{children:"GITHUB"}),void 0),(0,n.jsx)("a",Object.assign({style:{marginLeft:4,color:"inherit"},href:"#",onClick:()=>{u(!g),h(!0)}},{children:g?"SCREENSHOT MODE":"CAMERA MODE"}),void 0)]}),void 0)]},void 0)}}}]);
//# sourceMappingURL=798.2d611f7e79547462b2c2.js.map